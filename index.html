<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LENS | Laptop Ensemble Novi Sad</title>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --text-color: #00ff41; 
            --header-color: #1a1a1a;
            --font-family: 'Courier New', Courier, monospace;
            --glow: 0 0 8px rgba(0, 255, 65, 0.4);
        }

        body {
            background-color: #000; color: var(--text-color);
            font-family: var(--font-family); margin: 0;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; height: 100dvh; 
            overflow: hidden; text-shadow: var(--glow);
        }

        .crt-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%; pointer-events: none; z-index: 100;
        }

        #terminal-window {
            width: 95%; max-width: 900px; height: 90vh; height: 90dvh;
            background-color: var(--bg-color); border: 2px solid #222;
            display: flex; flex-direction: column; position: relative; z-index: 5;
        }

        #terminal-header {
            background-color: var(--header-color); padding: 10px 20px;
            display: flex; flex-direction: column;
            border-bottom: 1px solid #333; flex-shrink: 0;
        }

        .header-top { display: flex; align-items: center; justify-content: space-between; width: 100%; }

        #visualizer-canvas { 
            width: 100%; height: 50px; background: #000; 
            border-top: 1px solid #222; margin-top: 10px; display: block; 
        }

        .volume-box { display: flex; align-items: center; gap: 10px; font-size: 10px; color: #555; }
        input[type=range] { -webkit-appearance: none; background: #333; height: 2px; width: 80px; outline: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 10px; height: 10px; background: var(--text-color); cursor: pointer; }

        #fixed-nav-container {
            background-color: var(--header-color); padding: 10px 20px;
            border-bottom: 1px solid #333; display: flex; flex-wrap: wrap; gap: 8px; flex-shrink: 0;
        }

        nav { display: flex; flex-wrap: wrap; gap: 8px; }
        nav a {
            color: var(--text-color); text-decoration: none; cursor: pointer;
            font-size: 0.75rem; font-weight: bold; padding: 4px 8px;
            border: 1px solid var(--text-color); text-transform: uppercase;
        }
        nav a:hover { background: var(--text-color); color: #000; }

        #content-wrapper { flex-grow: 1; overflow-y: auto; padding: 25px; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        .history-block { margin-bottom: 40px; border-left: 1px solid #1a1a1a; padding-left: 15px; word-wrap: break-word; }

        .bytebeat-ui { border: 1px solid var(--text-color); padding: 20px; background: rgba(0, 255, 65, 0.05); margin-top: 15px; }
        .bb-formula { background: #000; border: 1px solid var(--text-color); color: #fff; padding: 10px; width: 100%; box-sizing: border-box; font-family: inherit; margin-bottom: 15px; display: block; }
        .bb-btn { background: var(--text-color); color: #000; border: none; padding: 8px 15px; cursor: pointer; font-weight: bold; font-family: inherit; }

        #input-line { display: flex; align-items: center; padding: 15px 20px; background: #050505; border-top: 1px solid #222; flex-shrink: 0; cursor: text; }
        #cmd-input { background: transparent; border: none; color: #fff; font-family: inherit; font-size: 1.1rem; width: 100%; outline: none; }

        h1 { font-size: 1.1rem; border-bottom: 1px solid var(--text-color); margin: 0 0 15px 0; display: inline-block; }

        @media (max-width: 600px) {
            #formula-monitor { display: none; }
            #content-wrapper { padding: 15px; }
            nav a { font-size: 0.65rem; }
            #terminal-header { padding: 10px; }
        }
    </style>
</head>
<body onclick="initAudio()">

<div class="crt-overlay"></div>

<div id="terminal-window">
    <div id="terminal-header">
        <div class="header-top">
            <div>
                <span id="audio-status" style="font-size: 11px; color: #555;">AUDIO: STANDBY</span>
                <div id="formula-monitor" style="font-size: 9px; color: #444; font-family: monospace; max-width: 400px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">[ TAP TO START ]</div>
            </div>
            <div class="volume-box">
                <span>VOL:</span>
                <input type="range" id="volume-slider" min="0" max="0.2" step="0.005" value="0.04">
            </div>
        </div>
        <canvas id="visualizer-canvas"></canvas>
    </div>

    <div id="fixed-nav-container">
        <nav>
            <a onclick="execute('home')">HOME</a>
            <a onclick="execute('about')">ABOUT</a>
            <a onclick="execute('concerts')">CONCERTS</a>
            <a onclick="execute('audio')">AUDIO</a>
            <a onclick="execute('video')">VIDEO</a>
            <a onclick="execute('links')">LINKS</a>
            <a onclick="execute('merch')">MERCH</a>
            <a onclick="execute('bytebeat')" style="color:#fff; border-color:#fff;">BYTEBEAT</a>
        </nav>
    </div>
    
    <div id="content-wrapper">
        <div id="output-area"></div>
    </div>

    <div id="input-line" onclick="document.getElementById('cmd-input').focus()">
        <span style="color:var(--text-color); font-weight:bold; margin-right:10px;">LENS:\></span>
        <input type="text" id="cmd-input" autocomplete="off" autocapitalize="none" spellcheck="false">
    </div>
</div>

<script>
    const output = document.getElementById('output-area');
    const input = document.getElementById('cmd-input');
    const wrapper = document.getElementById('content-wrapper');
    const volSlider = document.getElementById('volume-slider');
    const audioStatus = document.getElementById('audio-status');
    const formulaMonitor = document.getElementById('formula-monitor');

    let audioCtx = null, scriptNode = null, gainNode = null, analyser = null, t = 0;
    let s = [12, 8, 63, 4];
    let currentFormula = `t * ((t >> ${s[0]} | t >> ${s[1]}) & ${s[2]} & t >> ${s[3]})`;

    function updateFormula(newFormula, fromUser = false) {
        currentFormula = newFormula;
        formulaMonitor.innerText = `F: ${currentFormula}`;
        if (fromUser) {
            const matches = newFormula.match(/\d+/g);
            if (matches && matches.length >= 4) {
                s = matches.slice(0, 4).map(Number);
            }
        }
        const bbIn = document.getElementById('bb-input');
        if (bbIn) bbIn.value = newFormula;
    }

    function mutate() {
        const idx = Math.floor(Math.random() * 4);
        const change = Math.floor(Math.random() * 3) - 1 || 2; 
        s[idx] = Math.max(1, Math.min(128, s[idx] + change));
        updateFormula(`t * ((t >> ${s[0]} | t >> ${s[1]}) & ${s[2]} & t >> ${s[3]})`);
    }

    function initAudio() {
        if (audioCtx && audioCtx.state === 'running') return;
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 2048; 
        gainNode = audioCtx.createGain();
        gainNode.gain.value = volSlider.value;
        scriptNode = audioCtx.createScriptProcessor(4096, 1, 1);
        scriptNode.onaudioprocess = function(e) {
            const out = e.outputBuffer.getChannelData(0);
            for (let i = 0; i < out.length; i++) {
                try { 
                    const val = eval(currentFormula) & 255; 
                    out[i] = (val / 127.5) - 1; 
                    t++; 
                } catch (err) { out[i] = 0; }
            }
        };
        scriptNode.connect(analyser);
        analyser.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        audioStatus.innerText = "AUDIO: LIVE_EVOLVING";
        audioStatus.style.color = "var(--text-color)";
        draw(); 
    }

    function draw() {
        const canvas = document.getElementById('visualizer-canvas');
        if (canvas && analyser) {
            const ctx = canvas.getContext('2d');
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Float32Array(bufferLength);
            analyser.getFloatTimeDomainData(dataArray);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#00ff41';
            ctx.beginPath();
            const sliceWidth = canvas.width / bufferLength;
            let x = 0;
            for (let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] * 1.5; 
                const y = (0.5 + v * 0.5) * canvas.height;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
                x += sliceWidth;
            }
            ctx.stroke();
        }
        requestAnimationFrame(draw);
    }

    const sections = {
        home: `<h1>System Boot</h1><div class='home'><div class='home'><div class='home-photo'><img src="logo.jpg" class="member-img"></div>LAPTOP ENSEMBLE NOVI SAD</div><p><br>> Welcome to Laptop Ensemble Novi Sad terminal window. <br>> Every navigation click or typed command nudges the synthesis parameters. <br>> Type command or click the tabs to explore functions. Commands: 'home', 'about', 'concerts', 'audio', 'video', 'links', 'merch', 'bytebeat'. <br>> Edit the core string in BYTEBEAT to set the foundation for sound generation. </p></div>`,
        about: `<h1>About</h1><div class='member-grid'><div class='member-card'><div class='member-photo'><img src="lens.png" class="member-img"></div>LENS in kuda.org, 2024</div><p>The Laptop Ensemble Novi Sad (LENS) was founded in 2024 at the Academy of Arts in Novi Sad with the aim of exploring and developing the use of laptop computers as musical instruments. LENS members are Jovana Dragojević, Bojan Ožegović, Kosta Ranđelović and Milan Milojković. The ensemble's repertoire includes compositions by 20th and 21st-century authors who created live electronic music, along with electroacoustic improvisations (algorithmic and under direct performer control), and collaborative music-making over the internet. LENS’ repertoire (for now) consists of compositions of indeterminism, non-idiomatic improvisation as well as drone, processual, and intuitive music. Thus, LENS’ music seeks to implement principles of openness in the operation of this type of chamber ensemble, both in relation to the musical score and towards participants in the creation of the sound flow. </p></div>`,
        concerts: "<h1>Concerts</h1><p>> SKCNS, 27. 06. 2024, Novi Sad, Serbia <br>> Electronic Studio Radio Belgrade, 31. 8. 2024. <br>> Ruthenian cultural center Matka, Novi Sad, 14. 9. 2024. <br>> HardWired club Subotica 12. 10. 2025. <br>> KC Živa, Beograd, 29. 11. 2024. <br>> kuda.org, Novi Sad, 21.12.2024. <br>> @slump_o_o_l vol.4 @_vekks_Vienna, Austria 22. 3. 2025. <br>> Latitia's father's place, Antwerp, Belgium, NetPd improv session 29. 3. 2025. <br>> BUI, Onderbuik, Utrecht, Netherlands, 28. 3. 2025. <br>> Poetoskop uživo u blokiranom SKCNS, Novi Sad, 9. 5. 2025. <br>> Live at Changeover festival, klub Dim Beograd, 10. 10. 2025. <br>> Stevan Mokranjac Music School Kraljevo, Serbia, 14. 11. 2025. <br>> JMS club Subotica, Serbia, 19. 11. 2025. <br>> Cultural Centre of Vojvodina “Milos Crnjanski” 2. 12. 2025. <br>> ArtGet gallery Belgrade 5. 12. 2025. </p>",
        audio: "<h1>Audio</h1><p><a href='https://soundcloud.com/laptop_ensemble_novi_sad/lens-composition-no7-le-monte-young' target='_blank'>[▶] Composition no. 7 - Le Monte Young</a> <br> <a href='https://soundcloud.com/laptop_ensemble_novi_sad/lens-waves-stockhausen' target='_blank'>[▶] Waves - Karlheinz Stockhausen </a> <br> <a href='https://soundcloud.com/laptop_ensemble_novi_sad/lens-impuredata' target='_blank'>[▶] Impure Data - LENS </a> <br> <a href='https://soundcloud.com/laptop_ensemble_novi_sad/lens-clickydub' target='_blank'>[▶] Clicky Dub - LENS </a> <br> <a href='https://soundcloud.com/laptop_ensemble_novi_sad/lens-across-the-boundary-stockhausen' target='_blank'>[▶] Across the Boundary - Karlheinz Stockhausen </a> <br> <a href='https://soundcloud.com/laptop_ensemble_novi_sad/lens-treatise-p177-cardew' target='_blank'>[▶] Treatise, p. 177 - Cornelius Cardew </a> <br> <a href='https://soundcloud.com/laptop_ensemble_novi_sad/lens-esrb-ifthen-carl-bergstrom-nielsen' target='_blank'>[▶] If/Then - Carl Bergstrom Nielsen (Electronic studio Radio Belgrade)</a> <br> <a href='https://soundcloud.com/laptop_ensemble_novi_sad/lens-esrb-promprt-quartet' target='_blank'>[▶] Prompt Quartet - LENS (Electronic studio Radio Belgrade) </a> <br>  </p>",
        video: "<h1>Video</h1><p><a href='https://youtu.be/7usDNqjofFA' target='_blank'>[▶] Laptop Ensemble Novi Sad - Live at SKCNS </a> <br> <a href='https://youtu.be/icaJ_u7UIc4' target='_blank'>[▶] Laptop Ensemble Novi Sad - Live at Electronic Studio Radio Belgrade </a> <br> <a href='https://youtu.be/NCEaGXC5TaM' target='_blank'>[▶] Laptop Ensemble Novi Sad - Live at Matka </a> <br> <a href='https://youtu.be/PEEQyO3Tsvk' target='_blank'>[▶] Laptop Ensemble Novi Sad - Live at Жiva </a> <br> <a href='https://youtu.be/YEeiR7byDGk' target='_blank'>[▶] Laptop Ensemble Novi Sad - The Elementary principle of the Void (Decebal Scriba) </a> <br> <a href='https://youtu.be/0lMFp7C7k-c' target='_blank'>[▶] Laptop Ensemble Novi Sad - Kopipasta (Filip Đurović) </a> <br> <a href='https://youtu.be/T9xiWOdx79o' target='_blank'>[▶] Laptop Ensemble Novi Sad - Live at Vekks </a> <br> <a href='https://youtu.be/lPbSKtIjnq4' target='_blank'>[▶] Laptop Ensemble Novi Sad - Live at Latitia's father's place </a> <br> <a href='https://youtu.be/o-n2359WIjM' target='_blank'>[▶] Milica Hadžić, Darja Goldberg, Christoph Götzen, Filip Đurović & LENS - Improv session </a> <br> <a href='https://youtu.be/xt5uanx9Qxk' target='_blank'>[▶] Ivan Čkonjević, Ezra Stanisavljev, Laslo Lenkeš, Goran Lončarević i LENS - Poetoskop </a> <br> <a href='https://youtu.be/QurxqvjqvF4' target='_blank'>[▶] Laptop Ensemble Novi Sad - NetPixelNoiz </a> <br> <a href='https://youtu.be/FoE1q-lblz4' target='_blank'>[▶] Laptop Ensemble Novi Sad - Live at Changeover festival </a> <br> </p>",
        links: "<h1>Links</h1><p><a href='https://www.instagram.com/laptop_ensemble_ns/' target='_blank'> Instagram </a> <br> <a href='https://www.facebook.com/LaptopEnsembleNoviSad/' target='_blank'> Facebook </a> <br> <a href='https://laptopensemblenovisad.bandcamp.com/' target='_blank'> Bandcamp </a> <br>  </p>",
        merch: "<h1>Merch</h1><p> <a href='https://laptopensemblenovisad.bandcamp.com/album/kopipasta' target='_blank'> (floppy disk, 8khz 8bit wav) Kopipasta by Filip Đurović on 'Idiotski internat' label  </a> <br> </p>",
        bytebeat: `<h1>Manual Control</h1>
            <div class="bytebeat-ui">
                <p>Set Base Formula (Seeds for evolution):</p>
                <input type="text" id="bb-input" class="bb-formula" value="t * ((t >> 12 | t >> 8) & 63 & t >> 4)">
                <button class="bb-btn" onclick="updateFormula(document.getElementById('bb-input').value, true)">SET & EVOLVE</button>
                <p style="font-size:0.7rem; margin-top:10px; color:#555;">Typing a new formula here will reset the "seeds". Future mutations will grow from your input.</p>
            </div>`
    };

    volSlider.oninput = function() { if (gainNode) gainNode.gain.value = this.value; };

    function execute(cmd) {
        initAudio();
        const cleanCmd = cmd.toLowerCase().trim();
        if (cleanCmd !== 'bytebeat') {
            mutate();
            setTimeout(() => {
                document.querySelectorAll('.member-img').forEach(img => {
                    img.classList.remove('glitch-active');
                    void img.offsetWidth; 
                    img.classList.add('glitch-active');
                });
            }, 50);
        }
        if (cleanCmd === 'clear') { output.innerHTML = ""; return; }
        const html = sections[cleanCmd] ? `<div class="history-block">${sections[cleanCmd]}</div>` : `<div class="history-block">[PARAM_SHIFT]</div>`;
        output.innerHTML += html;
        setTimeout(() => { wrapper.scrollTop = wrapper.scrollHeight; }, 10);
        
        // Removed input.focus() from here to prevent keyboard from popping on tab-clicks
    }

    input.addEventListener('keydown', (e) => { 
        if (e.key === 'Enter') { 
            execute(input.value); 
            input.value = ""; 
            input.blur(); // Optional: hides keyboard after hitting enter
        } 
    });

    // Run home without forcing focus
    const homeHtml = `<div class="history-block">${sections['home']}</div>`;
    output.innerHTML = homeHtml;
</script>
</body>
</html>
